<div class="card-panel-container">
  <div class="card-header">
    <h2><mat-icon color="primary" style="vertical-align: middle;">credit_card</mat-icon> Mis Tarjetas</h2>
    <div class="actions">
      <button mat-raised-button color="primary" (click)="openAddCardDialog()">
        <mat-icon>add</mat-icon>
        Agregar Tarjeta
      </button>
      <button mat-raised-button color="accent" (click)="syncCard()">
        <mat-icon>sync</mat-icon>
        Sincronizar
      </button>
    </div>
  </div>

  <div class="card-dashboard-content">
    <!-- Carrusel tarjetas -->
    <div class="carousel-section-vertical">
      <div class="card-carousel-vertical">
        <mat-card *ngFor="let card of visibleCards" class="carousel-card">
          <mat-card-header>
            <mat-card-title>{{ card.nameAccount }}</mat-card-title>
            <mat-card-subtitle *ngIf="card.aliasAccount">{{ card.aliasAccount }}</mat-card-subtitle>
          </mat-card-header>
          <mat-card-content>
            <div class="balance">{{ getCardBalance(card) | currency:'CLP' }}</div>
          </mat-card-content>
          <mat-card-actions align="end">
            <button mat-icon-button color="primary" (click)="editCard(card)">
              <mat-icon>edit</mat-icon>
            </button>
            <button mat-icon-button color="warn" (click)="deleteCard(card.id, card.nameAccount)">
              <mat-icon>delete</mat-icon>
            </button>
          </mat-card-actions>
        </mat-card>
      </div>
    </div>

    <!-- Panel lateral: total + gráfico -->
    <div class="summary-section">
      <mat-card class="summary-card">
        <mat-card-title>Total en tarjetas activas</mat-card-title>
        <mat-card-content>
          <h2>{{ getTotalBalance() | currency:'CLP' }}</h2>
        </mat-card-content>
      </mat-card>
      <div class="chart-container" *ngIf="getPieChartData().length > 0; else emptyChart">
        <ngx-charts-pie-chart
          [results]="getPieChartData()"
          [view]="[380, 280]"
          [legend]="true"
          [doughnut]="true"
          [labels]="true"
          [explodeSlices]="false"
          [animations]="true">
        </ngx-charts-pie-chart>
      </div>
      <ng-template #emptyChart>
        <p class="no-data">No hay suficiente información para mostrar el gráfico.</p>
      </ng-template>
    </div>
  </div>
</div>
