<h2 mat-dialog-title align="center">Agregar Movimiento</h2>

<!-- Informaci贸n de l铆mites -->
<div class="limits-info" *ngIf="limitsInfo">
  <div class="limit-item">
    <mat-icon>receipt</mat-icon>
    <span>Movimientos manuales: {{ limitsInfo.manual_movements.used }}/{{ limitsInfo.manual_movements.limit }}</span>
    <div class="limit-bar">
      <div class="limit-progress" [style.width.%]="getProgressPercentage('manual_movements')"></div>
    </div>
  </div>
  
  <div class="limit-item" *ngIf="limitsInfo.max_cards">
    <mat-icon>credit_card</mat-icon>
    <span>Tarjetas activas: {{ limitsInfo.max_cards.used }}/{{ limitsInfo.max_cards.limit }}</span>
    <div class="limit-bar">
      <div class="limit-progress" [style.width.%]="getProgressPercentage('max_cards')"></div>
    </div>
  </div>
</div>

<!-- Notificaci贸n de l铆mites -->
<div class="limit-notification" *ngIf="showLimitNotification">
  <app-limit-notification 
    [data]="limitNotificationData"
    (onClose)="hideLimitNotification()">
  </app-limit-notification>
</div>

<mat-tab-group>
  <!-- Pesta帽a de Ingreso Manual -->
  <mat-tab label="Manual">
    <div mat-dialog-content>
      <form [formGroup]="manualForm" (ngSubmit)="onSubmit()">
        <div class="form-group">
          <label class="form-label">Tarjeta</label>
          <mat-form-field appearance="outline" floatLabel="always" class="full-width">
            <mat-select formControlName="cardId" required>
              <mat-option *ngFor="let card of cards$ | async" [value]="card.id">
                {{card.nameAccount}} {{card.accountHolder ? '(' + card.accountHolder + ')' : ''}}
              </mat-option>
            </mat-select>
            <mat-error *ngIf="manualForm.get('cardId')?.hasError('required')">
              Debes seleccionar una tarjeta
            </mat-error>
          </mat-form-field>
        </div>

        <div class="form-group">
          <label class="form-label">Tipo de Movimiento</label>
          <mat-form-field appearance="outline" floatLabel="always" class="full-width">
            <mat-select formControlName="movementType" required>
              <mat-option value="income"> Ingreso</mat-option>
              <mat-option value="expense"> Gasto</mat-option>
            </mat-select>
            <mat-error *ngIf="manualForm.get('movementType')?.hasError('required')">
              El tipo de movimiento es requerido
            </mat-error>
          </mat-form-field>
        </div>

        <div class="form-group">
          <label class="form-label">Descripci贸n</label>
          <mat-form-field appearance="outline" floatLabel="always" class="full-width">
            <input matInput 
                   placeholder="Ej: Pago de luz, Netflix, Salario, etc." 
                   formControlName="description" 
                   required />
            <mat-error *ngIf="manualForm.get('description')?.hasError('required')">
              La descripci贸n es requerida
            </mat-error>
          </mat-form-field>
        </div>

        <div class="form-group">
          <label class="form-label">Monto</label>
          <mat-form-field appearance="outline" floatLabel="always" class="full-width">
            <input matInput 
                   type="number" 
                   placeholder="Ej: 25000" 
                   formControlName="amount" 
                   min="1"
                   required />
            <mat-error *ngIf="manualForm.get('amount')?.hasError('required')">
              El monto es requerido
            </mat-error>
            <mat-error *ngIf="manualForm.get('amount')?.hasError('min')">
              El monto debe ser mayor a 0
            </mat-error>
          </mat-form-field>
        </div>

        <div class="form-group">
          <label class="form-label">Fecha</label>
          <mat-form-field appearance="outline" floatLabel="always" class="full-width">
            <input matInput 
                   formControlName="transactionDate" 
                   type="date" 
                   [min]="minDate"
                   class="date-input"
                   required />
            <mat-icon matSuffix class="date-icon" (click)="openDatePicker()">calendar_today</mat-icon>
            <mat-error *ngIf="manualForm.get('transactionDate')?.hasError('required')">
              La fecha es requerida
            </mat-error>
            <mat-error *ngIf="manualForm.get('transactionDate')?.hasError('minDate')">
              La fecha no puede ser anterior a hoy
            </mat-error>
          </mat-form-field>
        </div>

        <div mat-dialog-actions align="end">
          <button mat-button type="button" (click)="onCancel()" [disabled]="isProcessing">Cancelar</button>
          <button mat-raised-button color="primary" type="submit" [disabled]="!manualForm.valid || isProcessing">
            {{ isProcessing ? 'Procesando...' : 'Agregar' }}
          </button>
        </div>
      </form>
    </div>
  </mat-tab>
</mat-tab-group>
